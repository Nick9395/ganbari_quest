<!-- app/views/monthly_goals/edit.html.erb -->
<h1>振り返りの入力</h1>

<!-- 月選択フォーム -->
<%= form_with url: request.path, method: :get, local: true do %>
  <div class="flex-form-row">
    <!-- 年セレクタ -->
    <div>
      <%= label_tag :year, "年" %>
      <%= select_tag :year,
            options_for_select((2020..Date.today.year+3).to_a.reverse, @month.year),
            class: "form-control" %>
    </div>

    <!-- 月セレクタ -->
    <div>
      <%= label_tag :month, "月" %>
      <%= select_tag :month,
            options_for_select((1..12).map { |m| [sprintf("%02d", m), m] }, @month.month),
            class: "form-control" %>
    </div>

    <!-- 表示ボタン -->
    <div>
      <%= label_tag :dummy, "　" %> <!-- 高さ合わせ用の空ラベル -->
      <%= submit_tag "表示", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>

<!-- 入力フォーム -->
<% if @monthly_goal.persisted? %>
  <%= form_with model: [@user, @monthly_goal], url: user_monthly_goal_path(@user, @monthly_goal, month: @month), method: :patch, local: true do |f| %>
    <%= hidden_field_tag :month, @month.to_s %>

    <div>
      <%= f.label :review_text, "ふりかえり" %><br>
      <%= f.text_area :review_text %>
    </div>

    <%= f.submit "セーブしてもどる" %>
  <% end %>
<% else %>
  <%= form_with model: [@user, @monthly_goal], url: user_monthly_goals_path(@user, month: @month), method: :post, local: true do |f| %>
    <%= hidden_field_tag :month, @month.to_s %>

    <div>
      <%= f.label :review_text, "ふりかえり" %><br>
      <%= f.text_area :review_text %>
    </div>

    <%= f.submit "セーブしてもどる" %>
  <% end %>
<% end %>
